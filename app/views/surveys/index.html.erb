<%= stylesheet_link_tag 'surveys_table' %>

<h1> <%= t '.all_surveys' %> </h1>

<%= link_to t(".create_survey"), new_survey_path, :action => :post %>

<div>
  <table class="surveys_table">
    <thead>
      <th><%= Survey.human_attribute_name(:name) %></th>
      <th><%= Survey.human_attribute_name(:description) %></th>
      <th><%= Survey.human_attribute_name(:expiry_date) %></th>
      <th><%= Survey.human_attribute_name(:responses) %></th>
      <th><%= t ".operations" %></th>
    </thead>
    <tbody>
      <% @surveys.each do |survey| %>
      <tr class="survey_row">
        <td><%= survey.name %></td>
        <td class="survey_description">
          <span class="truncated_description">
            <%= truncate(survey.description, :length => 120)%>
          </span>
          <div class="more_description">
            <%= survey.description%>
          </div>
          <% if survey.description.length > 120 %>
            <%= link_to t(".more"), '#', :class => 'more_description_link' %>
            <%= link_to t(".less"), '#', :class => 'less_description_link' %>
          <% end %>
        </td>
        <td class="survey_expiry_date"><%= survey.expiry_date %></td>
        <td>
          <%= survey.responses.count %>
          <%= link_to image_tag("add.png", :title => t(".add_response")), new_survey_response_path(survey.id) %>
        </td>
        <td>
          <%= link_to image_tag("delete.png"), survey_path(survey.id), :method => :delete, :data => { :confirm => t(:confirm) } %>
          <% unless survey.published %>
            <%= link_to button_tag(t ".publish_survey"), survey_publish_path(survey.id), :method => :put, :data => { :confirm => t(:confirm) } %>
          <% else %>
            <%= link_to button_tag(t ".unpublish_survey"), survey_unpublish_path(survey.id), :method => :put, :data => { :confirm => t(:confirm) } %>
          <% end %>
        </td>
      </tr>
      <% end %>
    </tbody>  
  </table>
</div>

<%= will_paginate @surveys %>

<script type="text/javascript">
$(document).ready(function() {
  $('.survey_row').each(function(_, elem) {
    new SurveyApp.SurveyRow($(elem));
  });
});
</script>
